<!DOCTYPE html>
<html>
<head>
    <title>Customer Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" ></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        button {
            background-color: #4661a4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        h2 {
            margin-top: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #DDD;
        }

        tr:hover {
            background-color: #dad6ee;
        }

        .fa {
            font-size: 20px;
        }

        .fa-minus-circle {
            color: red;
        }

        #createCustomerForm, #cusDetHeading{
            display: none;
        }
    </style>
</head>
<body>

    <button id="addCustomerButton" onclick="openAddCusForm()">Add Customer</button>    
    <h2 id="cusDetHeading" style="text-align: center;">Customer Details</h2>
    <table id="createCustomerForm" style="max-width: 800px; margin: 0 auto;">
        <tr>
            <td style="padding: 10px; box-sizing: border-box;">
                <label for="first_name"></label>
                <input type="text" id="first_name" placeholder="First name" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
            <td style="padding: 10px; box-sizing: border-box;">
                <label for="last_name"></label>
                <input type="text" id="last_name" placeholder="Last name" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
        </tr>
        <tr>
            <td colspan="2" style="padding: 10px; box-sizing: border-box;">
                <label for="address"></label>
                <input type="text" id="address" placeholder="Address" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; box-sizing: border-box;">
                <label for="street"></label>
                <input type="text" id="street" placeholder="Street" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
            <td style="padding: 10px; box-sizing: border-box;">
                <label for="city"></label>
                <input type="text" id="city" placeholder="City" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; box-sizing: border-box;">
                <label for="state"></label>
                <input type="text" id="state" placeholder="State" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
            <td style="padding: 10px; box-sizing: border-box;">
                <label for="email"></label>
                <input type="email" id="email" placeholder="Email" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
        </tr>
        <tr>
            <td colspan="2" style="padding: 10px; box-sizing: border-box;">
                <label for="phone"></label>
                <input type="number" id="phone" placeholder="Phone" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
            </td>
        </tr>
        <tr>
            <td colspan="2" style="padding: 10px; box-sizing: border-box; text-align: center;">
                <button type="button" id="addNew" onclick="addNewUser()" style="background-color: #4661a4; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Submit</button>
            </td>
        </tr>
    </table>

    <h2 style="text-align: center;">Customer List</h2>

    <table id="customerTable">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Street</th>
                <th>Address</th>
                <th>City</th>
                <th>State</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="customerTableBody">
            <!-- Customer data will be dynamically added here -->
           
        </tbody>
    </table>

    <script>
        //add new customer
        function addNewUser(){
            var firstName= document.getElementById('first_name');
            var lastName= document.getElementById('last_name');
            var address= document.getElementById('address');
            var street= document.getElementById('street');
            var city= document.getElementById('city');
            var state= document.getElementById('state');
            var email= document.getElementById('email');
            var phoneNo= document.getElementById('phone');

            //API call to store new user data
            var settings = {
                "url": "https://qa2.sunbasedata.com/sunbase/portal/api/assignment.jsp?cmd=create",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer dGVzdEBzdW5iYXNlZGF0YS5jb206VGVzdEAxMjM="
                },
                "data": JSON.stringify({
                    "first_name": firstName,
                    "last_name": lastName,
                    "street": street,
                    "address": address,
                    "city": city,
                    "state":state,
                    "email": email,
                    "phone": phoneNo
                }),
            };

            $.ajax(settings).done(function (response) {
                console.log(response);
                location.reload();
            });

        }

        //get user list
        $(document).ready(function(){
            var settings = {
                "url": "https://qa2.sunbasedata.com/sunbase/portal/api/assignment.jsp?cmd=get_customer_list",
                "method": "GET",
                "headers": {
                    "Authorization": "Bearer dGVzdEBzdW5iYXNlZGF0YS5jb206VGVzdEAxMjM="
                },
            };

            $.ajax(settings).done(function (response) {
                console.log(response);
                var tableBody= document.getElementById('customerTableBody');
                console.log(tableBody.innerHTML)
                var userList= response;
                for(var i=0; i<userList.length; i++){
                    var innerHTML= '<tr><td><input name="f_name" value="'+userList[i].first_name+'"></td><td><input name="l_name" value="'+userList[i].last_name+'"></td><td><input name="cus_street" value="'+userList[i].street+'"></td><td><input name="cus_addr" value="'+userList[i].address+'"></td><td><input name="cus_city" value="'+userList[i].city+'"></td><td><input name="cus_state" value="'+userList[i].state+'"></td><td><input name="cus_email" value="'+userList[i].email+'"></td><td><input name="cus_phone" value="'+userList[i].phone+'"></td><td><span id="btn-del" onclick="delUser('+"'"+userList[i].uuid+"'"+',this)"><i class="fa fa-minus-circle"></i></span>&nbsp;&nbsp;&nbsp;&nbsp;<span id="btn-update" onclick="updateUser('+"'"+userList[i].uuid+"'"+', this)"><i class="fa fa-pencil"></i></span></td></tr>';
                    tableBody.innerHTML+= innerHTML;
                }
            });
            
        });
        
        //delete users from the list
        function delUser(uuid){
            var rowId= uuid;
            console.log(rowId);
            var settings = {
                "url": "https://qa2.sunbasedata.com/sunbase/portal/api/assignment.jsp?cmd=delete&uuid="+rowId,
                "method": "POST",
                "headers": {
                    "Authorization": "Bearer dGVzdEBzdW5iYXNlZGF0YS5jb206VGVzdEAxMjM="
                },
            };

            $.ajax(settings).done(function (response) {
                console.log(response);
                location.reload();
            });
        }

        //update existing users
        function updateUser(uuid, c_this){
            var firstName= c_this.parentElement.parentElement.children[0].children[0].value;
            var lastName= c_this.parentElement.parentElement.children[1].children[0].value;
            var address= c_this.parentElement.parentElement.children[2].children[0].value;
            var street= c_this.parentElement.parentElement.children[3].children[0].value;
            var city= c_this.parentElement.parentElement.children[4].children[0].value;
            var state= c_this.parentElement.parentElement.children[5].children[0].value;
            var email= c_this.parentElement.parentElement.children[6].children[0].value;
            var phoneNo= c_this.parentElement.parentElement.children[7].children[0].value;
            var settings = {
                "url": "https://qa2.sunbasedata.com/sunbase/portal/api/assignment.jsp?cmd=update&uuid="+uuid,
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer dGVzdEBzdW5iYXNlZGF0YS5jb206VGVzdEAxMjM="
                },
                "data": JSON.stringify({
                    "first_name": firstName,
                    "last_name": lastName,
                    "street": address,
                    "address": street,
                    "city": city,
                    "state": state,
                    "email": email,
                    "phone": phoneNo
                }),
            };

            $.ajax(settings).done(function (response) {
                console.log(response);
                location.reload();
            });
        }

        //on click of ADD CUSTOMER button
        function openAddCusForm(){
            var addCusForm= document.getElementById('createCustomerForm');
            var cusDetHeading= document.getElementById('cusDetHeading');
            addCusForm.style.display= "table";
            cusDetHeading.style.display= "block";
        }
    </script>
</body>
</html>
